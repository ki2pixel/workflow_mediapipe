# Contexte Actif (Active Context)

## Tâche en Cours
Aucune tâche active.

## Objectifs
- [2026-01-21 13:15:00] **Migration download_history → SQLite (COMPLET)** : Remplacement du fichier `download_history.json` par un repository SQLite multi-workers (`download_history_repository`), création/exécution du script `scripts/migrate_download_history_to_sqlite.py` (34 URL migrées) puis suppression des fichiers legacy. Tests ciblés : `pytest -q tests/unit/test_csv_service_url_normalization.py tests/integration/test_csv_dry_run.py tests/integration/test_csv_monitor_no_retrigger.py tests/integration/test_double_encoded_urls.py`.
- [2026-01-20 20:02:00] **Audit Logs Panel — Phase 2 (Intégration Timeline-Logs) (COMPLET)** : Refactor du panneau logs en overlay plus contextuel (header enrichi : étape/statut/timer, boutons “logs spécifiques” globaux), alignement renforcé Timeline↔Logs en mode compact (ancrage vertical près de l’étape active). Fichiers modifiés : `templates/index_new.html`, `static/css/components/logs.css`, `static/domElements.js`, `static/uiUpdater.js`, `tests/frontend/test_timeline_logs_phase2.mjs`, `package.json`. Validation : `npm run test:frontend` OK.
- [2026-01-20 18:17:00] **Audit Logs Panel — Phase 1 (Cohérence Visuelle Immédiate) (COMPLET)** : Harmonisation du panneau de logs avec la Timeline Connectée (palette + motion unifiées, axe visuel “spine” dans le panel). Fichiers modifiés : `static/css/components/logs.css`, `static/css/layout.css`. Validation : `npm run test:frontend` OK.
- [2026-01-20 12:53:00] **Auto-scroll Timeline Connectée — Correction structurelle du centrage vertical (COMPLET)** : Résolution définitive du problème de glissement progressif des étapes vers le bas pendant les séquences. Solution structurelle implémentée : (1) Ajout d'un espace scrollable en bas de timeline (`timeline-scroll-spacer`) pour permettre le centrage de STEP7, (2) Suppression des `scroll-margin-top` biaisés sur `.timeline-step` et `.steps-column`, (3) Recentrage throttlé pendant la progression dans `uiUpdater.js` (700ms) pour compenser les changements de hauteur du `progress_text`, (4) Scroll déterministe dans `scrollManager.js` (calcul direct + `window.scrollTo` au lieu de `scrollIntoView`), (5) Simplification de `sequenceManager.js` pour utiliser un chemin unique `scrollToActiveStep({behavior:'smooth'})`. Tests frontend OK. En attente de validation manuelle après hard refresh.
- [2026-01-20 09:00:00] **Timeline Connectée — Phase 1 (HTML/CSS) (COMPLET)** : Implémentation de la Phase 1 du redesign Dashboard `index_new.html` selon `docs/workflow/audits/AUDIT_UX_DASHBOARD_UNIFIED-2026-01-20.md`. Ajouts de variables Timeline (tailles + `*-rgb` + palette pipeline) dans `static/css/variables.css`, refonte des styles steps vers une présentation "Timeline" (spine, nœuds, connecteurs, zone `.node-actions`) dans `static/css/components/steps.css`, et mise à jour de la boucle Jinja des steps dans `templates/index_new.html` avec structure sémantique (`role="list"/`role="listitem"`, `workflow-steps`, `timeline-step`). Compatibilité JS conservée (IDs/classe `.step`, boutons `.run-button`/`.cancel-button`/`.specific-log-button`, checkboxes `.custom-sequence-checkbox`).
- [2026-01-20 10:00:00] **Timeline Connectée — Phase 2 (Visual Polish) (COMPLET)** : Implémentation de la Phase 2 du redesign Dashboard : harmonisation des transitions et micro-interactions premium (hover/focus-within) sur la Timeline (spine/nœuds/connecteurs), ajout d’un focus-visible global, et ajustements responsive ciblés sans changement HTML/JS. Fichiers modifiés : `static/css/variables.css`, `static/css/base.css`, `static/css/components/steps.css`.
- [2026-01-20 10:55:00] **Timeline Connectée — Phase 3 (Advanced Features) (COMPLET)** : Implémentation de la Phase 3 du redesign Dashboard : panneau de détails contextuel synchronisé avec AppState + DOMBatcher (clic/clavier, focus restore, fermeture auto logs), accessibilité complète (aria-expanded, navigation clavier, Escape, aria-live), optimisations UI (layout compact coexistence logs/détails, rafraîchissement différé, import dynamique), tests frontend Given/When/Then (`test_step_details_panel.mjs`) intégrés à `npm run test:frontend`. Fichiers modifiés : `templates/index_new.html`, `static/css/components/steps.css`, `static/css/layout.css`, `static/main.js`, `static/stepDetailsPanel.js`, `static/uiUpdater.js`, `tests/frontend/test_step_details_panel.mjs`, `package.json`.
- [2026-01-20 01:12:00] **Maintenance Tests Backend — Phase 1-3 (COMPLET)** : Application complète du Guide de Maintenance Tests Backend suite à l'audit 2026-01-20. Corrections critiques : migration `_get_app_state` → `get_workflow_state`, suppression méthodes obsolètes, correction imports Lemonfox, implémentation locale méthodes manquantes. Phase 2 : isolation environnement avec scripts spécialisés et configuration pytest. Phase 3 : refactoring avec fixtures standardisées et scripts d'automatisation. Résultats : 67 tests passés Phase 1, 281 tests principaux Phase 2, patterns standardisés Phase 3. Documentation complète dans `BACKEND_TESTS_MAINTENANCE_GUIDE.md`.
- [2026-01-18 21:00:00] **Suppression Feature "Étape 5 · Options avancées" — COMPLET** : Suppression complète de la fonctionnalité de configuration dynamique des chunks STEP5. Modifications : frontend (`templates/index_new.html`, `static/main.js`, `static/apiService.js`, `static/css/components/controls.css`), backend (`routes/api_routes.py`, `services/workflow_service.py`, `app_new.py`, `workflow_scripts/step5/run_tracking_manager.py`), documentation nettoyée. Tests frontend OK, architecture simplifiée, chunking adaptatif fonctionne avec valeurs par défaut. Passe globale de vérification terminée : 0 artefact restant.
- [2026-01-18 20:29:00] **Suppression Supervision UI — COMPLET** : Boutons Diagnostics/Statistiques/Téléversement retirés (templates/index_new.html, static/main.js, static/domElements.js), Chart.js déchargé, raccourcis clavier nettoyés. Tests non exécutés (UI-only), inspection visuelle recommandée.
- [2026-01-18 02:10:00] **Audit UX/UI Unifié — Sprint 1** : Hiérarchie boutons primaires/secondaires, repositionnement widget système, palette d’états unifiée et styles disabled standardisés. Frontend prêt pour validation visuelle finale.

## Décisions Récentes
- [2026-01-20 20:02:00] **Audit Logs Panel — Phase 2 (Intégration Timeline-Logs)** : Ajout d’un header contextuel (étape/statut/timer) et d’un conteneur global de boutons “logs spécifiques” dans le panneau logs, avec ancrage vertical du panneau en mode compact près de l’étape active. Test frontend dédié ajouté (`test_timeline_logs_phase2.mjs`). Validation : `npm run test:frontend` OK.
- [2026-01-20 12:53:00] **Auto-scroll Timeline Connectée — Correction structurelle du centrage vertical** : Résolution définitive du problème de glissement progressif des étapes vers le bas pendant les séquences. Solution structurelle : (1) Espace scrollable en bas de timeline (`timeline-scroll-spacer`) pour permettre le centrage de STEP7, (2) Suppression des `scroll-margin-top` biaisés sur `.timeline-step` et `.steps-column`, (3) Recentrage throttlé pendant la progression dans `uiUpdater.js` (700ms) pour compenser les changements de hauteur du `progress_text`, (4) Scroll déterministe dans `scrollManager.js` (calcul direct + `window.scrollTo` au lieu de `scrollIntoView`), (5) Simplification de `sequenceManager.js` pour utiliser un chemin unique `scrollToActiveStep({behavior:'smooth'})`. Tests frontend OK. En attente de validation manuelle après hard refresh.
- [2026-01-20 01:12:00] **Maintenance Tests Backend — Application complète Guide de Maintenance** : Application des 3 phases du guide de maintenance tests backend. Phase 1 : corrections critiques (migration `_get_app_state` → `get_workflow_state`, suppression méthodes obsolètes, correction imports Lemonfox, implémentation locale méthodes manquantes). Phase 2 : isolation environnement (scripts spécialisés, configuration pytest). Phase 3 : refactoring (fixtures standardisées, scripts d'automatisation). Résultats : 67 tests passés Phase 1, 281 tests principaux Phase 2, patterns standardisés Phase 3. Documentation complète dans `BACKEND_TESTS_MAINTENANCE_GUIDE.md`.
- [2026-01-20 10:55:00] **Timeline Connectée — Phase 3 (Advanced Features)** : Implémentation complète du panneau de détails contextuel (StepDetailsPanel.js) synchronisé avec AppState et DOMBatcher, accessibilité WCAG renforcée (aria-expanded, navigation clavier, focus trap/restore, gestion Escape, aria-live), optimisations UI (coexistence logs/détails en compact, rafraîchissement différé via import dynamique, cache léger WeakMap), et tests frontend Given/When/Then (`test_step_details_panel.mjs`) ajoutés à la suite `npm run test:frontend`. Validation : `npm run test:frontend` OK. Audit mis à jour (Phase 3 ✅). Aucune régression fonctionnelle.
- [2026-01-18 21:00:00] **Suppression Feature "Étape 5 · Options avancées"** : Suppression complète de la fonctionnalité de configuration dynamique des chunks STEP5 (chunk min/max) du frontend et backend. Modifications : `templates/index_new.html` (section Settings retirée), `static/main.js` (fonction `initializeStep5AdvancedControls()` supprimée), `static/apiService.js` (API `setStep5ChunkBoundsAPI` supprimée), `routes/api_routes.py` (route `/api/step5/chunk_bounds` supprimée), `services/workflow_service.py` (méthode `set_step5_chunk_bounds()` supprimée), `app_new.py` (propagation `TRACKING_CHUNK_MIN/MAX` supprimée), `workflow_scripts/step5/run_tracking_manager.py` (lecture env vars supprimée), documentation nettoyée. Tests frontend OK, architecture simplifiée, chunking adaptatif fonctionne avec valeurs par défaut.
- [2026-01-18 00:09:03] Audit Frontend — finalisation complète : correction XSS P0, focus trap/restauration sur toutes les modales, ajout tests critiques, optimisation regex logs, échappement systématique popup, support prefers-reduced-motion. Validation : `npm run test:frontend` OK.
- [2026-01-18 02:10:00] Audit UX/UI Unifié Sprint 1 : adoption des recommandations Court Terme (contrôles topbar hiérarchisés, widget système bas-gauche, badges d’état normalisés, styles disabled globaux).

## Questions Ouvertes
Aucune question ouverte.

## Prochaines Étapes
- [2026-01-20 10:55:00] **Timeline Connectée — Phase 3 (Advanced Features) (COMPLET)** : Implémentation complète du panneau de détails contextuel (StepDetailsPanel.js) synchronisé avec AppState et DOMBatcher, accessibilité WCAG renforcée (aria-expanded, navigation clavier, focus trap/restore, gestion Escape, aria-live), optimisations UI (coexistence logs/détails en compact, rafraîchissement différé via import dynamique, cache léger WeakMap), et tests frontend Given/When/Then (`test_step_details_panel.mjs`) ajoutés à la suite `npm run test:frontend`. Validation : `npm run test:frontend` OK. Audit mis à jour (Phase 3 ✅). Aucune régression fonctionnelle.