<!doctype html>
<html lang="fr">
  <meta charset="utf-8" />
  <title>Rapport Mensuel Archives - {{ month }}</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 6px; }
    .meta { color: #666; font-size: 12px; margin-bottom: 12px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 13px; }
    th { background: #fafafa; text-align: left; }
    .section { margin-top: 20px; }
    ul { margin: 6px 0 12px 18px; }
    li { margin: 2px 0; }
    .video-names { margin: 4px 0 0 0; }
    .video-name { display: block; padding-left: 4px; }
  </style>
  </head>
<body>
  <h1>Rapport Mensuel Archives — {{ month }}</h1>
  <div class="meta">Généré le {{ generated_at }} · Build {{ build_id }}</div>
  <table>
    <thead>
      <tr><th>Projet</th><th>Horodatage</th><th>Vidéos</th><th>Scènes</th><th>Parole (s)</th><th>Faces (frames)</th></tr>
    </thead>
    <tbody>
      {% for p in projects %}
      <tr>
        <td>{{ p.display_base }}</td>
        <td>{{ p.archive_timestamp or '-' }}</td>
        <td style="text-align:right">{{ p.video_count }}</td>
        <td style="text-align:right">{{ p.videos | sum(attribute='statistics.scenes.total_count') }}</td>
        <td style="text-align:right">{{ p.videos | sum(attribute='statistics.audio.total_speech_duration') | round(1) }}</td>
        <td style="text-align:right">{{ p.videos | sum(attribute='statistics.tracking.frames_with_faces') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="section">
    <h2>Répartition des Durées par Projet</h2>
    {% for p in projects %}
      <div>
        <strong>{{ p.display_base }}</strong> :
        <ul>
          <li>
            moins de 2 minutes : {{ p.duration_counts.lt_2m }}
            {% if p.duration_names and p.duration_names.lt_2m %}
              : <div class="video-names">
                  {% for nm in p.duration_names.lt_2m %}
                    <div class="video-name">{{ nm }}</div>
                  {% endfor %}
                </div>
            {% endif %}
          </li>
          <li>
            entre 2 et 5 minutes : {{ p.duration_counts.between_2_5m }}
            {% if p.duration_names and p.duration_names.between_2_5m %}
              : <div class="video-names">
                  {% for nm in p.duration_names.between_2_5m %}
                    <div class="video-name">{{ nm }}</div>
                  {% endfor %}
                </div>
            {% endif %}
          </li>
          <li>
            plus de 5 minutes : {{ p.duration_counts.gt_5m }}
            {% if p.duration_names and p.duration_names.gt_5m %}
              : <div class="video-names">
                  {% for nm in p.duration_names.gt_5m %}
                    <div class="video-name">{{ nm }}</div>
                  {% endfor %}
                </div>
            {% endif %}
          </li>
        </ul>
      </div>
    {% endfor %}
  </div>
</body>
</html>
