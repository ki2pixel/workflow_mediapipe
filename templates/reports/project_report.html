<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport de Projet - {{ project_name }}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background:#f5f5f5; color:#333; padding:20px; }
        .container { max-width: 1200px; margin:0 auto; background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); padding:40px; }
        .header { border-bottom:3px solid #007bff; padding-bottom:16px; margin-bottom:24px; }
        .header h1 { color:#007bff; margin:0 0 6px; }
        .section { margin:28px 0; }
        .section-title { color:#007bff; border-left:4px solid #007bff; padding-left:12px; font-size:22px; margin-bottom:12px; }
        .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap:16px; }
        .card { background:#f8f9fa; border-left:4px solid #007bff; border-radius:8px; padding:16px; }
        .badge { display:inline-block; padding:4px 10px; border-radius:12px; font-size:12px; font-weight:600; margin-right:8px; }
        .badge-info { background:#17a2b8; color:#fff; }
        .table { width:100%; border-collapse:collapse; }
        .table th, .table td { border-bottom:1px solid #e9ecef; padding:10px; text-align:left; }
        .table th { background:#f1f3f5; }
        .muted { color:#666; font-size:13px; }
    </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìÅ Rapport Consolid√© du Projet</h1>
    <div class="muted">Projet: <strong>{{ project_name }}</strong> ¬∑ G√©n√©r√© le {{ generated_at }}</div>
  </div>

  <div class="section">
    <h2 class="section-title">üìä Statistiques Globales</h2>
    <div class="grid">
      <div class="card"><div class="muted">Dur√©e Totale</div><div style="font-size:28px;color:#007bff;">{{ consolidated.video.duration_seconds|format_duration }}</div></div>
      <div class="card"><div class="muted">Frames Totales</div><div style="font-size:28px;color:#007bff;">{{ consolidated.video.total_frames|int }}</div></div>
      <div class="card"><div class="muted">FPS Moyen</div><div style="font-size:28px;color:#007bff;">{{ consolidated.video.fps|round(2) }}</div></div>
      <div class="card"><div class="muted">Sc√®nes Totales</div><div style="font-size:28px;color:#007bff;">{{ consolidated.scenes.total_count|int }}</div></div>
      <div class="card"><div class="muted">Segments de Parole</div><div style="font-size:28px;color:#007bff;">{{ consolidated.audio.total_segments|int }}</div></div>
      <div class="card"><div class="muted">Locuteurs Uniques</div><div style="font-size:28px;color:#007bff;">{{ consolidated.audio.unique_speakers|int }}</div></div>
      <div class="card"><div class="muted">Couverture Parole</div><div style="font-size:28px;color:#007bff;">{{ consolidated.audio.speech_coverage_percent|format_percentage }}</div></div>
      <div class="card"><div class="muted">Frames avec Visages</div><div style="font-size:28px;color:#007bff;">{{ consolidated.tracking.frames_with_faces|int }}</div></div>
    </div>
  </div>

  <div class="section">
    <h2 class="section-title">üé¨ D√©tails par Vid√©o</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Vid√©o</th>
          <th>Dur√©e</th>
          <th>Sc√®nes</th>
          <th>Locuteurs</th>
          <th>Segments</th>
          <th>Faces (max)</th>
          <th>Couverture Visages</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        {% for v in videos %}
        <tr>
          <td>{{ v.video_name }}</td>
          {% if v.error %}
            <td colspan="6" class="muted">‚Äî</td>
            <td><span class="badge badge-info">Erreur</span> {{ v.error }}</td>
          {% else %}
            <td>{{ v.statistics.video.duration_seconds|format_duration }}</td>
            <td>{{ v.statistics.scenes.total_count|int }}</td>
            <td>{{ v.metadata.get('speaker_count', 0) or v.statistics.audio.unique_speakers|int }}</td>
            <td>{{ v.statistics.audio.total_segments|int }}</td>
            <td>{{ v.statistics.tracking.max_faces_detected|int }}</td>
            <td>{{ v.statistics.tracking.face_coverage_percent|format_percentage }}</td>
            <td><span class="badge badge-info">OK</span></td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="section" style="text-align:center;color:#666;font-size:13px;">
    Rapport g√©n√©r√© par MediaPipe Workflow Analysis System ¬∑ {{ generated_at }}
  </div>
</div>
</body>
</html>